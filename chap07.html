

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ja" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ja" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>7. スクリプトとしてのPython &mdash; Python演習(地球惑星物理学演習)</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
    <link rel="prev" title="6. NumPy配列の基本" href="chap06.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Python演習
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="chap01.html">1. はじめに</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap02.html">2. Pythonの基本</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap03.html">3. 対話型の実行方法</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap04.html">4. 制御構造と関数・オブジェクト</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap05.html">5. 便利な組み込み型</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap06.html">6. NumPy配列の基本</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">7. スクリプトとしてのPython</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">7.1. スクリプトの基本</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">7.1.1. 実行方法（復習）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">7.1.2. 作法</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id6">7.2. ファイルの読み書きと文字列処理</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id7">7.2.1. ファイルの読み書き</a></li>
<li class="toctree-l3"><a class="reference internal" href="#str">7.2.2. <code class="docutils literal notranslate"><span class="pre">str</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#re">7.2.3. <code class="docutils literal notranslate"><span class="pre">re</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id11">7.3. システムインターフェース</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id12">7.3.1. ファイルやディレクトリの操作</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id16">7.3.2. シェルコマンドの実行</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id18">7.4. コマンドライン引数の処理</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id19">7.5. 第7章 演習課題</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id20">7.5.1. 課題1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id21">7.5.2. 課題2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id22">7.5.3. 課題3</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id23">7.5.4. 課題4</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Python演習</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li><span class="section-number">7. </span>スクリプトとしてのPython</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="python">
<h1><a class="toc-backref" href="#id30"><span class="section-number">7. </span>スクリプトとしてのPython</a><a class="headerlink" href="#python" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>これまで見てきたようにPythonの大きな強みは対話的に実行ができることである．一方で対話的な実行では，毎回必ず人間が何らかの操作をしなければならない．Pythonでも最低限の人間の操作でまとまった処理を自動化することができると大変便利である．Pythonではbashなどを用いたシェルスクリプトの代替のような使い方から，GUIアプリケーションや，より高度なプログラム開発まで様々なことができる．ここではコマンドラインで実行できるPythonスクリプト開発の基本を学ぼう．</p>
<div class="admonition seealso">
<p class="admonition-title">参考</p>
<ul class="simple">
<li><p><a class="reference internal" href="chap07_sample1_py.html"><span class="doc">sample1.py</span></a> : スクリプトの基本</p></li>
<li><p><a class="reference internal" href="chap07_sample2_py.html"><span class="doc">sample2.py</span></a> : ファイルの読み書きと文字列処理</p></li>
<li><p><a class="reference internal" href="chap07_sample3_py.html"><span class="doc">sample3.py</span></a> : システムインターフェース</p></li>
<li><p><a class="reference internal" href="chap07_sample4_py.html"><span class="doc">sample4.py</span></a> : コマンドライン引数の処理</p></li>
</ul>
</div>
<div class="contents topic" id="id1">
<p class="topic-title">この章の内容</p>
<ul class="simple">
<li><p><a class="reference internal" href="#python" id="id30">スクリプトとしてのPython</a></p>
<ul>
<li><p><a class="reference internal" href="#id2" id="id31">スクリプトの基本</a></p></li>
<li><p><a class="reference internal" href="#id6" id="id32">ファイルの読み書きと文字列処理</a></p></li>
<li><p><a class="reference internal" href="#id11" id="id33">システムインターフェース</a></p></li>
<li><p><a class="reference internal" href="#id18" id="id34">コマンドライン引数の処理</a></p></li>
<li><p><a class="reference internal" href="#id19" id="id35">第7章 演習課題</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id31"><span class="section-number">7.1. </span>スクリプトの基本</a><a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="id3">
<h3><span class="section-number">7.1.1. </span>実行方法（復習）<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="chap02.html"><span class="doc">ここ</span></a> で既に見たように， <code class="docutils literal notranslate"><span class="pre">*.py</span></code> という名前で保存したPythonのソースコード（スクリプト）はコマンドラインで実行することができる．ここではもう一度 <a class="reference internal" href="chap02_hello_py.html"><span class="doc">hello.py</span></a> を見直してみよう．</p>
<div class="literal-block-wrapper docutils container" id="id24">
<div class="code-block-caption"><span class="caption-text"><a class="reference internal" href="chap02_hello_py.html"><span class="doc">hello.py</span></a> （再掲）</span><a class="headerlink" href="#id24" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hello, World !&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<p>この一行目の <code class="docutils literal notranslate"><span class="pre">#!/usr/bin/env</span> <span class="pre">python</span></code> はUnix-likeなOSで</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ ./hello.py
</pre></div>
</td></tr></table></div>
<p>のように実行するときにこのスクリプトをPythonで解釈するためのオマジナイである．最近は諸々の事情でシステム内にPython環境が複数存在することも多いので，混乱を避けるために以下では</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ python hello.py
</pre></div>
</td></tr></table></div>
<p>のように実行することにしよう．例えばバージョンの違う複数のPython環境がシステムに存在するときには陽に自分が使いたいPythonのコマンドを指定すればよい．例えば，最近では流石に少なくなったが，古いPython-2.xでしか動かないコードを実行するときには，明示的にそれを指定する必要がある．Python-2.xのパスが <code class="docutils literal notranslate"><span class="pre">/usr/local/bin/python2</span></code> であるときに，これを用いてスクリプトを実行したい場合には</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ /usr/local/bin/python2 hello.py
</pre></div>
</td></tr></table></div>
<p>のように実行すればよい．</p>
</div>
<div class="section" id="id4">
<h3><span class="section-number">7.1.2. </span>作法<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Pythonのスクリプトでは以下のような書き方がよく見られる．</p>
<div class="literal-block-wrapper docutils container" id="id25">
<div class="code-block-caption"><span class="caption-text"><a class="reference internal" href="chap07_sample1_py.html"><span class="doc">sample1.py</span></a></span><a class="headerlink" href="#id25" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">3.14</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;main() is called&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;n = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This will be printed only if run as a script&#39;</span><span class="p">)</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<p>14行目以降の <code class="docutils literal notranslate"><span class="pre">if</span></code> ブロックはこのプログラムがスクリプトとして実行された場合にのみ実行される．これは，このファイルがスクリプトとして実行されたとき（トップレベルスクリプトと呼ぶ）のみ <code class="docutils literal notranslate"><span class="pre">__name__</span></code> という特殊な変数に <code class="docutils literal notranslate"><span class="pre">__main__</span></code> という名前が（Pythonによって自動的に）与えられるようになっているためである．したがって，このファイルを実行すると以下のような結果が得られる．</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ python sample1.py
This will be printed only <span class="k">if</span> run as a script
main<span class="o">()</span> is called
<span class="nv">n</span> <span class="o">=</span> <span class="m">10</span>
<span class="nv">x</span> <span class="o">=</span> <span class="m">3</span>.14
</pre></div>
</td></tr></table></div>
<p>11行目までのコードは変数や関数の宣言のみであり，実行は14行目以降で行われていることが分かる．このような書き方がよく用いられるのは，このファイルが他のファイルや，Jupyter Notebookなどの対話的環境から <code class="docutils literal notranslate"><span class="pre">import</span></code> される可能性を考慮しているからである．例えばコマンドラインで以下のように実行してみよう．</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ python -c <span class="s1">&#39;import sample1; sample1.main();&#39;</span>
main<span class="o">()</span> is called
<span class="nv">n</span> <span class="o">=</span> <span class="m">10</span>
<span class="nv">x</span> <span class="o">=</span> <span class="m">3</span>.14
</pre></div>
</td></tr></table></div>
<p>ここで <code class="docutils literal notranslate"><span class="pre">-c</span></code> オプションで与えられた文字列をPythonが解釈して実行している．まず <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">sample1</span></code> でこのファイルをモジュールとして <code class="docutils literal notranslate"><span class="pre">import</span></code> し，このモジュールで定義された関数 <code class="docutils literal notranslate"><span class="pre">sample1.main()</span></code> を実行している．この場合は14行目以降の <code class="docutils literal notranslate"><span class="pre">if</span></code> ブロックは実行されていないことが分かる．このように単なるスクリプトとしての実行だけでなく，自分が <code class="docutils literal notranslate"><span class="pre">import</span></code> されたときの場合も考えて</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># トップレベルスクリプトとして実行される処理</span>
</pre></div>
</td></tr></table></div>
<p>のような形でトップレベルスクリプトとしての実行文とそれ以外を分離しておくのが作法になっている．</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>スクリプトを開発している際にも対話型の環境を用いると便利である．例えば，ある機能を実装する関数を実装するときにも，対話型の実行環境でその都度動作確認をしながら実装すると効率が良い．ここで紹介した作法でスクリプトに関数を実装していれば，ソースコードを修正し，その都度Jupyter Notebookなどで <code class="docutils literal notranslate"><span class="pre">import</span></code> や <code class="docutils literal notranslate"><span class="pre">importlib.reload</span></code> しながら関数単体の動作確認ができる（トップレベルスクリプトとしては実行されない）．
例えばJupyter Notebookのセルで</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sample1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sample1</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>した後に <code class="docutils literal notranslate"><span class="pre">sample1.py</span></code> を修正したとき，同じJupyterセッション中であっても</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">importlib</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">sample1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sample1</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>のように <code class="docutils literal notranslate"><span class="pre">importlib.reaload</span></code> することで，その修正を反映させることができる．
<code class="docutils literal notranslate"><span class="pre">importlib.reload</span></code> については <a class="reference external" href="https://docs.python.org/ja/3/library/importlib.html#importlib.reload">公式ドキュメント</a> を参照のこと．</p>
</div>
</div>
</div>
<div class="section" id="id6">
<h2><a class="toc-backref" href="#id32"><span class="section-number">7.2. </span>ファイルの読み書きと文字列処理</a><a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="id7">
<h3><span class="section-number">7.2.1. </span>ファイルの読み書き<a class="headerlink" href="#id7" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="chap06.html"><span class="doc">NumPy配列の基本</span></a>  ではすでにバイナリファイルの読み書きについて扱ったが，テキストファイルの扱いもほとんど同様である．例えば以下の例を見てみよう．</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;testfile.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>ここで <code class="docutils literal notranslate"><span class="pre">open()</span></code> には開きたいファイル名および読み書きのモードを与える．この例では書き込み <code class="docutils literal notranslate"><span class="pre">w</span></code> モードでファイルを開く．これによってファイルオブジェクトが返されるので，<code class="docutils literal notranslate"><span class="pre">write()</span></code> メソッドを呼び出してで文字列を書き込み， <code class="docutils literal notranslate"><span class="pre">close()</span></code> で最後にファイルを閉じる．次にこのファイルの中身を読み込んでみよう．これにはモードを <code class="docutils literal notranslate"><span class="pre">r</span></code> としてファイルを開き， <code class="docutils literal notranslate"><span class="pre">read()</span></code> メソッドを呼び出せばよい．</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;testfile.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">&#39;hello&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>ここで <code class="docutils literal notranslate"><span class="pre">read()</span></code> はデフォルトでファイルの中身を全て読み込むが，引数で読み込むデータサイズ（バイト単位）を指定することもできる．また <code class="docutils literal notranslate"><span class="pre">readline()</span></code> は1行を読み込み， <code class="docutils literal notranslate"><span class="pre">readlines()</span></code> はファイルの中身を全て読み込み，各行をlistとして返す．</p>
<p>また，一度開いたファイルは必要が無くなったら閉じるのが作法であるが，これを忘れるのを防ぐために最近では <code class="docutils literal notranslate"><span class="pre">with</span></code> が使われることが多い．以下の例を見てみよう．</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># 書き込み</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;testfile.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;hello</span><span class="se">\n</span><span class="s1">python&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 読み込み</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;testfile.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">())</span>
<span class="go">[&#39;hello\n&#39;, &#39;python&#39;]</span>
</pre></div>
</td></tr></table></div>
<p>ここでは <code class="docutils literal notranslate"><span class="pre">with</span></code> で開いたファイルを <code class="docutils literal notranslate"><span class="pre">f</span></code> として，ファイルの読み書きを行っているが <code class="docutils literal notranslate"><span class="pre">with</span></code> のブロックを抜けると，自動的に <code class="docutils literal notranslate"><span class="pre">close()</span></code> が呼ばれるので，閉じ忘れの心配がない． <code class="docutils literal notranslate"><span class="pre">open()</span></code> については <a class="reference external" href="https://docs.python.org/ja/3/library/functions.html#open">公式ドキュメント</a> も参照しよう．</p>
</div>
<div class="section" id="str">
<h3><span class="section-number">7.2.2. </span><code class="docutils literal notranslate"><span class="pre">str</span></code><a class="headerlink" href="#str" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Pythonによる文字列処理には組み込みの文字列オブジェクトである <code class="docutils literal notranslate"><span class="pre">str</span></code> の種々なメソッドを駆使して行えばよい．例えば <code class="docutils literal notranslate"><span class="pre">split()</span></code> は引数で与えられた文字（デフォルトではホワイトスペース）を区切りとして，元の文字列を分割したlistを返す．また， <code class="docutils literal notranslate"><span class="pre">join()</span></code> は引数で与えられた文字列のシーケンス(listやtuple)を結合する．使い方は以下の例を見れば明らかであろう．</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;I love python&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="go">[&#39;I&#39;, &#39;love&#39;, &#39;python&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;hate&#39;</span><span class="p">,</span> <span class="s1">&#39;fortran&#39;</span><span class="p">])</span>
<span class="go">&#39;I_hate_fortran&#39;</span>
</pre></div>
</td></tr></table></div>
<p>他にも以下の例のように <code class="docutils literal notranslate"><span class="pre">find()</span></code> メソッドを使って文字列を検索したり，配列のように添字 <code class="docutils literal notranslate"><span class="pre">[]</span></code> を用いて部分文字列を取り出したりすることができる．</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Earth and Planetary Physics&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Planet&#39;</span><span class="p">)</span>
<span class="go">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text</span><span class="p">[</span><span class="mi">10</span><span class="p">:]</span>
<span class="go">&#39;Planetary Physics&#39;</span>
</pre></div>
</td></tr></table></div>
<p>より詳細については <a class="reference external" href="https://docs.python.org/ja/3/library/stdtypes.html#textseq">公式ドキュメント</a> を参照のこと．</p>
</div>
<div class="section" id="re">
<h3><span class="section-number">7.2.3. </span><code class="docutils literal notranslate"><span class="pre">re</span></code><a class="headerlink" href="#re" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>先の例の <code class="docutils literal notranslate"><span class="pre">find()</span></code> は厳密に一致する文字列を検索するのには十分であるが，より柔軟な文字列の検索・置換には正規表現が用いられる．Pythonでは標準ライブラリの <code class="docutils literal notranslate"><span class="pre">re</span></code> (regular expression)が正規表現を扱うためのモジュールになっている．正規表現そのものの詳細についてはここでは立ち入らないが，ツールによって微妙に正規表現のシンタックス（文法）が異なることがあるので注意しよう．Pythonの正規表現については <a class="reference external" href="https://docs.python.org/ja/3/library/re.html">公式ドキュメント</a> を参照して欲しい．</p>
<p>ここでは <code class="docutils literal notranslate"><span class="pre">re</span></code> モジュールの使い方を簡単に見てみよう．</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">url1</span> <span class="o">=</span> <span class="s1">&#39;https://www.eps.s.u-tokyo.ac.jp&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url2</span> <span class="o">=</span> <span class="s1">&#39;https://www.eps.s.u-tokyo.ac.jp/epp/&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">https_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;https://([a-zA-Z0-9\-\.]+)/?.*&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 検索</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">https_pattern</span><span class="p">,</span> <span class="n">url1</span><span class="p">)</span>
<span class="go">&lt;re.Match object; span=(0, 31), match=&#39;https://www.eps.s.u-tokyo.ac.jp&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">https_pattern</span><span class="p">,</span> <span class="n">url2</span><span class="p">)</span>
<span class="go">&lt;re.Match object; span=(0, 36), match=&#39;https://www.eps.s.u-tokyo.ac.jp/epp/&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># グループを取り出す</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">https_pattern</span><span class="p">,</span> <span class="n">url1</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="s1">&#39;www.eps.s.u-tokyo.ac.jp&#39;</span><span class="p">,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">https_pattern</span><span class="p">,</span> <span class="n">url2</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="s1">&#39;www.eps.s.u-tokyo.ac.jp&#39;</span><span class="p">,)</span>
</pre></div>
</td></tr></table></div>
<p>上のコードでは <code class="docutils literal notranslate"><span class="pre">re.saerch()</span></code> を使って文字列 <code class="docutils literal notranslate"><span class="pre">url1</span></code> および <code class="docutils literal notranslate"><span class="pre">url2</span></code> からhttpsプロトコルのURLを表すパターン <code class="docutils literal notranslate"><span class="pre">https_pattern</span></code> を検索している．パターンが見つかると <code class="docutils literal notranslate"><span class="pre">re.search()</span></code> は <code class="docutils literal notranslate"><span class="pre">re.Match</span></code> オブジェクトを返す．ここで謎の呪文のようにも見える <code class="docutils literal notranslate"><span class="pre">https_pattern</span></code> が正規表現である．ここで <code class="docutils literal notranslate"><span class="pre">[a-zA-Z0-9\-\.]+</span></code> がアルファベット（大文字・小文字），数字， <code class="docutils literal notranslate"><span class="pre">-</span></code> および <code class="docutils literal notranslate"><span class="pre">.</span></code> の1回以上の繰り返しを意味している．このパターンが <code class="docutils literal notranslate"><span class="pre">()</span></code> で囲まれているが，これによって囲まれた範囲がグループ化され， <code class="docutils literal notranslate"><span class="pre">re.Match</span></code> オブジェクトの <code class="docutils literal notranslate"><span class="pre">groups()</span></code> メソッドを呼ぶことで各グループにアクセスすることができる． <code class="docutils literal notranslate"><span class="pre">re.Match</span></code> そのものはURL全体にマッチしているが，この場合はグループの最初の要素がURLのドメイン部分だけを示している．</p>
<p>以下の例では <code class="docutils literal notranslate"><span class="pre">re.sub()</span></code> を用いてURLの <code class="docutils literal notranslate"><span class="pre">https</span></code> を <code class="docutils literal notranslate"><span class="pre">http</span></code> に置換している．</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;https://([a-zA-Z0-9\-\.]/?.*)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;http://\1&#39;</span><span class="p">,</span> <span class="n">url1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;http://www.eps.s.u-tokyo.ac.jp&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;https://([a-zA-Z0-9\-\.]/?.*)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;http://\1&#39;</span><span class="p">,</span> <span class="n">url2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;http://www.eps.s.u-tokyo.ac.jp/epp/&#39;</span>
</pre></div>
</td></tr></table></div>
<p>ここで <code class="docutils literal notranslate"><span class="pre">re.sub()</span></code> の第2引数の <code class="docutils literal notranslate"><span class="pre">\1</span></code> には第1引数で指定したパターンの <code class="docutils literal notranslate"><span class="pre">()</span></code> で囲まれたグループが代入される．複数のグループがある場合には <code class="docutils literal notranslate"><span class="pre">\1</span></code>， <code class="docutils literal notranslate"><span class="pre">\2</span></code>，...のように各グループを指定すればよい．</p>
<p><code class="docutils literal notranslate"><span class="pre">re.finditer()</span></code> は検索したパターンを順に処理するループを記述するのに便利である． <a class="reference internal" href="chap07_sample2_py.html"><span class="doc">sample2.py</span></a> はPythonのソースコードから関数定義を検索するサンプルで，以下には <code class="docutils literal notranslate"><span class="pre">re.finditer()</span></code> を用いたループを抜粋している．第1引数 <code class="docutils literal notranslate"><span class="pre">pattern</span></code> にマッチする部分を第2引数 <code class="docutils literal notranslate"><span class="pre">text</span></code> から検索して，見つかった順にループ内で処理をしている．</p>
<div class="literal-block-wrapper docutils container" id="id26">
<div class="code-block-caption"><span class="caption-text"><a class="reference internal" href="chap07_sample2_py.html"><span class="doc">sample2.py</span></a> （抜粋）</span><a class="headerlink" href="#id26" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">):</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># 関数名</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># 引数リスト</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">groups</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">args</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">args</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">narg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;found function named </span><span class="si">{}</span><span class="s1"> with </span><span class="si">{}</span><span class="s1"> argument(s)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">narg</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
</div>
<p>このように <code class="docutils literal notranslate"><span class="pre">re</span></code> モジュールを使うことで柔軟な検索や置換処理が実装できる．</p>
</div>
</div>
<div class="section" id="id11">
<h2><a class="toc-backref" href="#id33"><span class="section-number">7.3. </span>システムインターフェース</a><a class="headerlink" href="#id11" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="id12">
<h3><span class="section-number">7.3.1. </span>ファイルやディレクトリの操作<a class="headerlink" href="#id12" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>ファイルやディレクトリの操作をするための便利な関数群がPythonの標準ライブラリで提供されている．bashなどのシェルスクリプトは基本的にはUnix-likeなOSでの動作が前提となるが，Pythonのライブラリをうまく使うことでOSなどの環境に依らないプログラムを作ることが可能である <a class="footnote-reference brackets" href="#crossplatform" id="id13">1</a> ．</p>
<p>これには標準ライブラリの <code class="docutils literal notranslate"><span class="pre">os</span></code> モジュール（およびそのサブモジュール）を <code class="docutils literal notranslate"><span class="pre">import</span></code> して使えばよい．例えば <code class="docutils literal notranslate"><span class="pre">os.listdir()</span></code> は与えられたパス内の全てのファイルとディレクトリをlistオブジェクトとして返す．したがって，シェルで</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ ls
test.txt  testdir/
</pre></div>
</td></tr></table></div>
<p>となる環境であれば，</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="go">[&#39;testdir&#39;, &#39;test.txt&#39;]</span>
</pre></div>
</td></tr></table></div>
<p>なる結果が得られる．この結果として返されるlistの各要素がファイルかディレクトリか調べるには <code class="docutils literal notranslate"><span class="pre">os.path.isfile()</span></code> や <code class="docutils literal notranslate"><span class="pre">os.path.isdir()</span></code> を使えばよい．例えば</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; is a file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; is a directory&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
<span class="go">&quot;testdir&quot; is a directory</span>
<span class="go">&quot;test.txt&quot; is a file</span>
</pre></div>
</td></tr></table></div>
<p>のような結果が得られる．また，以下は指定されたディレクトリのファイルのうちPythonのソースコードだけを抽出し，各ファイルの行数を数える関数 <code class="docutils literal notranslate"><span class="pre">count_py_lines1()</span></code> の実装例である．</p>
<div class="literal-block-wrapper docutils container" id="id27">
<div class="code-block-caption"><span class="caption-text"><a class="reference internal" href="chap07_sample3_py.html"><span class="doc">sample3.py</span></a> （抜粋）</span><a class="headerlink" href="#id27" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">count_py_lines1</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*** count_by_lines1&#39;</span><span class="p">)</span>
    <span class="c1"># ファイルとディレクトリのリスト</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
    <span class="n">files</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="c1"># 拡張子をチェックしてpythonのソースであれば行数を数える</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;.py&#39;</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">readlines</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> : number of lines = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
</div>
<p>ファイルやディレクトリの操作で注意しなければならないのはパスの区切り文字である．Windowsではパスの区切り文字として <code class="docutils literal notranslate"><span class="pre">\</span></code> が使われているのに対してMacやLinuxなどでは <code class="docutils literal notranslate"><span class="pre">/</span></code> が使われているので，どちらの環境でも動くスクリプトにするためにはプログラム側でこの違いを吸収してやらなければならない．Pythonでは <code class="docutils literal notranslate"><span class="pre">os.sep</span></code> （または <code class="docutils literal notranslate"><span class="pre">os.path.sep</span></code> ）がパスの区切り文字として定義されているので，これを使うことでプラットフォームに依存しないプログラムとすることができる．例えば <code class="docutils literal notranslate"><span class="pre">os.getcwd()</span></code> で現在の作業ディレクトリを取得し，これにファイル名を文字列として結合して絶対パスとするには <code class="docutils literal notranslate"><span class="pre">os.path.join()</span></code> を用いて</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;test.txt&#39;</span><span class="p">)</span>
<span class="go">/home/hoge/test.txt</span>
</pre></div>
</td></tr></table></div>
<p>のようにすればよい．ここでは <code class="docutils literal notranslate"><span class="pre">os.getcwd()</span></code> で得られる <code class="docutils literal notranslate"><span class="pre">/home/hoge</span></code> と <code class="docutils literal notranslate"><span class="pre">test.txt</span></code> が区切り文字 <code class="docutils literal notranslate"><span class="pre">/</span></code> で結合されているが，同じコードをWindowsで実行すれば自動的に区切り文字として <code class="docutils literal notranslate"><span class="pre">\</span></code> が選ばれる．同じことが</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;test.txt&#39;</span><span class="p">])</span>
<span class="go">/home/hoge/test.txt</span>
</pre></div>
</td></tr></table></div>
<p>でも可能である．これは <code class="docutils literal notranslate"><span class="pre">str</span></code> オブジェクトである <code class="docutils literal notranslate"><span class="pre">os.sep</span></code> の <code class="docutils literal notranslate"><span class="pre">join</span></code> メソッドを使った例である．</p>
<p>他にもファイルの作成やファイル名変更，削除などの一通りの作業ができる．詳細については <a class="reference external" href="https://docs.python.org/ja/3/library/os.html">公式ドキュメント</a> を確認して欲しい．ただし，ファイルのコピーや削除などのより高レベルの（より簡単な）ファイル操作には標準ライブラリの <code class="docutils literal notranslate"><span class="pre">shutil</span></code> モジュール（ <a class="reference external" href="https://docs.python.org/ja/3/library/shutil.html">公式ドキュメント</a> ）を用いる方が便利であろう．</p>
</div>
<div class="section" id="id16">
<h3><span class="section-number">7.3.2. </span>シェルコマンドの実行<a class="headerlink" href="#id16" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">os</span></code> モジュールの <code class="docutils literal notranslate"><span class="pre">os.system()</span></code> を使うとPythonプログラムからシェルコマンド（例えば <code class="docutils literal notranslate"><span class="pre">ls</span></code> や <code class="docutils literal notranslate"><span class="pre">cat</span></code> など）を実行することができる．使い方は以下の通りである．</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;echo &quot;hello shell&quot;&#39;</span><span class="p">)</span>
<span class="go">hello shell</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="go">0</span>
</pre></div>
</td></tr></table></div>
<p>ここでシェルで実行されたコマンドの終了ステータスが返値となる．</p>
<p>単にコマンドを実行するだけであればこれでも十分だが，実用的にはシェルコマンドに何らかの入力を与えたり，また実行結果を受け取って処理をしたくなってくる．これには <code class="docutils literal notranslate"><span class="pre">subprocess</span></code> モジュールを使うのがよい．例えば，先ほどの例と同じことは <code class="docutils literal notranslate"><span class="pre">subprocess.run()</span></code> を使って</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;echo &quot;hello shell&quot;&#39;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">hello shell</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">returncode</span><span class="p">)</span>
<span class="go">0</span>
</pre></div>
</td></tr></table></div>
<p>のように実現できる．ここで <code class="docutils literal notranslate"><span class="pre">subprocess.run()</span></code> に <code class="docutils literal notranslate"><span class="pre">shell=True</span></code> としているのは第1引数で与えた文字列をシェルで解釈するという意味である．このオプションを指定しないときには</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;echo&#39;</span><span class="p">,</span> <span class="s1">&#39;hello shell&#39;</span><span class="p">])</span>
<span class="go">hello shell</span>
</pre></div>
</td></tr></table></div>
<p>のようにlistとしてコマンドラインに与える引数を与える必要がある．（シェルとして解釈させるのはセキュリティ的にあまり好ましくないので注意する必要がある．）</p>
<p>シェルのパイプ（ <code class="docutils literal notranslate"><span class="pre">|</span></code> ）のように標準出力をPythonで受け取って処理をするには <code class="docutils literal notranslate"><span class="pre">capture_output=True</span></code> と <code class="docutils literal notranslate"><span class="pre">text=True</span></code> を指定すればよい <a class="footnote-reference brackets" href="#versionnote" id="id17">2</a> ．</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;echo&#39;</span><span class="p">,</span> <span class="s1">&#39;hello shell&#39;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="go">hello shell</span>
</pre></div>
</td></tr></table></div>
<p>基本的にはシェルコマンドを使わないでもPythonだけで実現できることがほとんどであるが，シェルなら簡単にできるようなことであれば，このようにその実行結果を受け取って処理する方が話が早いこともあるだろう．例えば以下は先に示した関数 <code class="docutils literal notranslate"><span class="pre">count_py_lines1()</span></code> と全く同じ機能をシェルコマンドで実現する関数 <code class="docutils literal notranslate"><span class="pre">count_py_lines2()</span></code> の実装例である．</p>
<div class="literal-block-wrapper docutils container" id="id28">
<div class="code-block-caption"><span class="caption-text"><a class="reference internal" href="chap07_sample3_py.html"><span class="doc">sample3.py</span></a> （抜粋）</span><a class="headerlink" href="#id28" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">count_py_lines2</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*** count_by_lines2&#39;</span><span class="p">)</span>
    <span class="c1"># wcコマンドで行数を数える</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;wc -l </span><span class="si">{}</span><span class="s1">/*.py&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># コマンドの出力からファイル名と行数を取り出す</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;.py&#39;</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> : number of lines = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
<div class="section" id="id18">
<h2><a class="toc-backref" href="#id34"><span class="section-number">7.4. </span>コマンドライン引数の処理</a><a class="headerlink" href="#id18" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Unixのコマンドは多くの引数やオプションを受け取り，それに応じて異なる処理を実行する．Pythonでは標準ライブラリの <code class="docutils literal notranslate"><span class="pre">argparse</span></code> を使うことで，コマンドラインで与えられた引数を簡単に処理することができる．使い方は簡単で， <code class="docutils literal notranslate"><span class="pre">argparse.ArgumentParser()</span></code> でオブジェクトを生成し， <code class="docutils literal notranslate"><span class="pre">add_argument()</span></code> でオプションを順次定義していけばよい．以下の例は <a class="reference internal" href="chap07_sample4_py.html"><span class="doc">sample4.py</span></a> の抜粋である．</p>
<div class="literal-block-wrapper docutils container" id="id29">
<div class="code-block-caption"><span class="caption-text"><a class="reference internal" href="chap07_sample4_py.html"><span class="doc">sample4.py</span></a> （抜粋）</span><a class="headerlink" href="#id29" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parse_args</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Print Greetings&#39;</span><span class="p">)</span>
    <span class="c1"># 整数</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-i&#39;</span><span class="p">,</span> <span class="s1">&#39;--integer&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;number of output&#39;</span><span class="p">)</span>
    <span class="c1"># 文字列</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-g&#39;</span><span class="p">,</span> <span class="s1">&#39;--greeting&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;greeting&#39;</span><span class="p">)</span>
    <span class="c1"># 真偽値（デフォルトはFalse）</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;--capitalize&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;capitalize or not&#39;</span><span class="p">)</span>

    <span class="c1"># デフォルトではsys.argvをパース</span>
    <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<p>このサンプルでは <code class="docutils literal notranslate"><span class="pre">--integer</span></code> で指定された回数だけ <code class="docutils literal notranslate"><span class="pre">--greeting</span></code> で指定された文字列を出力する．また <code class="docutils literal notranslate"><span class="pre">--capitalize</span></code> を指定されると，指定された文字列の各単語の先頭文字を大文字に変換する．以下はコマンドの具体的な実行例である．</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ python sample4.py --integer <span class="m">3</span> -c -g <span class="s1">&#39;hello python scripting&#39;</span>
*** command-line arguments
<span class="o">[</span><span class="s1">&#39;sample4.py&#39;</span>, <span class="s1">&#39;--integer&#39;</span>, <span class="s1">&#39;3&#39;</span>, <span class="s1">&#39;-c&#39;</span>, <span class="s1">&#39;-g&#39;</span>, <span class="s1">&#39;hello python scripting&#39;</span><span class="o">]</span>

*** parse results
option: <span class="nv">integer</span> <span class="o">=</span>&gt; <span class="m">3</span>
option: <span class="nv">greeting</span> <span class="o">=</span>&gt; hello python scripting
option: <span class="nv">capitalize</span> <span class="o">=</span>&gt; True

*** show greetings
Hello Python Scripting
Hello Python Scripting
Hello Python Scripting
</pre></div>
</td></tr></table></div>
<p>Unixの多くのコマンドでは長いオプションと，その省略形のオプションを使うことができるが，それはこの例でも同様である．例えば，11-12行目は <code class="docutils literal notranslate"><span class="pre">--integer</span></code> とその省略形 <code class="docutils literal notranslate"><span class="pre">-i</span></code> を <code class="docutils literal notranslate"><span class="pre">type=int</span></code> で整数型として定義している．また17-18行目は <code class="docutils literal notranslate"><span class="pre">--capitalize</span></code> で指定される真偽値のオプションを定義しており，デフォルトでは <code class="docutils literal notranslate"><span class="pre">False</span></code> だが，オプションが指定されると <code class="docutils literal notranslate"><span class="pre">True</span></code> となるよう <code class="docutils literal notranslate"><span class="pre">action='store_true'</span></code> で指定されている．オプションの指定が終わった後にパーサーオブジェクトの <code class="docutils literal notranslate"><span class="pre">parse_args()</span></code> メソッドを呼ぶと自動的に <code class="docutils literal notranslate"><span class="pre">sys.argv</span></code> に格納されているコマンドラインオプションがパースされるので，後はこれを適宜用いればよい． <code class="docutils literal notranslate"><span class="pre">parse_args()</span></code> で返されるオブジェクトにはそれぞれのオプションがアトリビュートとして保存されているので，例えば <code class="docutils literal notranslate"><span class="pre">--integer</span></code> オプションであれば <code class="docutils literal notranslate"><span class="pre">.integer</span></code> アトリビュートを参照すればよい．</p>
<p>なお，この <code class="docutils literal notranslate"><span class="pre">argparse</span></code> を使うと自動的にヘルプメッセージが生成され，オプションとして <code class="docutils literal notranslate"><span class="pre">-h</span></code> や <code class="docutils literal notranslate"><span class="pre">--help</span></code> を指定すると以下のようにヘルプメッセージが表示される．</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ python sample4.py -h
usage: sample4.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-i INTEGER<span class="o">]</span> <span class="o">[</span>-g GREETING<span class="o">]</span> <span class="o">[</span>-c<span class="o">]</span>

Print Greetings

optional arguments:
  -h, --help            show this <span class="nb">help</span> message and <span class="nb">exit</span>
  -i INTEGER, --integer INTEGER
                        number of output
  -g GREETING, --greeting GREETING
                        greeting
  -c, --capitalize      capitalize or not
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id19">
<h2><a class="toc-backref" href="#id35"><span class="section-number">7.5. </span>第7章 演習課題</a><a class="headerlink" href="#id19" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="admonition seealso">
<p class="admonition-title">参考</p>
<ul class="simple">
<li><p><a class="reference internal" href="chap07_kadai2_py.html"><span class="doc">課題2解答例</span></a></p></li>
<li><p><a class="reference internal" href="chap07_kadai3_py.html"><span class="doc">課題3解答例</span></a></p></li>
<li><p><a class="reference internal" href="chap07_kadai4_py.html"><span class="doc">課題4解答例</span></a></p></li>
</ul>
</div>
<div class="section" id="id20">
<h3><span class="section-number">7.5.1. </span>課題1<a class="headerlink" href="#id20" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>サンプルを実行して動作を確認せよ．</p>
</div>
<div class="section" id="id21">
<h3><span class="section-number">7.5.2. </span>課題2<a class="headerlink" href="#id21" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>コマンドラインで与えられた（HTTPまたはHTTPSプロトコルの）URLにアクセスして得られた結果（html）からtitleタグの内容を抽出して表示するプログラムを作成せよ． <code class="docutils literal notranslate"><span class="pre">urllib.request.urlopen()</span></code> を使って得られたバイト列を文字列に変換（デコード）し，正規表現を用いてtitleタグの中身を抽出すればよい．サイトによって様々な文字コードが使われているので， <code class="docutils literal notranslate"><span class="pre">chardet.detect()</span></code> で推測したエンコーディングでデコードするのがよいだろう．例えば，以下のような実行結果が得られればよい．</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ python kadai2.py https://www.eps.s.u-tokyo.ac.jp/
東京大学 理学部 地球惑星物理学科・地球惑星環境学科／大学院理学系研究科 地球惑星科学専攻 <span class="p">|</span>
$ python kadai2.py https://www.yahoo.co.jp/
Yahoo! JAPAN
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id22">
<h3><span class="section-number">7.5.3. </span>課題3<a class="headerlink" href="#id22" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>シェルの <code class="docutils literal notranslate"><span class="pre">ls</span></code> コマンドのようにカレントディレクトリに存在するファイルやディレクトリのリストを表示するプログラムを作成せよ．ただし，デフォルトではファイル名のアルファベット順（ <code class="docutils literal notranslate"><span class="pre">ls</span></code> のデフォルト）で， <code class="docutils literal notranslate"><span class="pre">-S</span></code> オプションが指定された場合はファイルサイズの降順で（ <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-S</span></code> と同じ順で）表示するものとする．また，どちらの場合も <code class="docutils literal notranslate"><span class="pre">-r</span></code> が指定された場合には表示順を逆にせよ（ <code class="docutils literal notranslate"><span class="pre">ls</span></code> と同じ仕様である）．例えば以下のような実行結果が得られればよい．</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ python kadai3.py -S
    <span class="m">2844</span> Fri Apr <span class="m">22</span> <span class="m">13</span>:42:47 <span class="m">2022</span> kadai4.py
    <span class="m">1707</span> Fri Apr <span class="m">22</span> <span class="m">13</span>:42:47 <span class="m">2022</span> kadai3.py
     <span class="m">763</span> Fri Apr <span class="m">22</span> <span class="m">13</span>:42:47 <span class="m">2022</span> kadai2.py
$ python kadai3.py -Sr
     <span class="m">763</span> Fri Apr <span class="m">22</span> <span class="m">13</span>:42:47 <span class="m">2022</span> kadai2.py
    <span class="m">1707</span> Fri Apr <span class="m">22</span> <span class="m">13</span>:42:47 <span class="m">2022</span> kadai3.py
    <span class="m">2844</span> Fri Apr <span class="m">22</span> <span class="m">13</span>:42:47 <span class="m">2022</span> kadai4.py
</pre></div>
</td></tr></table></div>
<p>なお，この例ではファイル名だけでなく，ファイルサイズや更新日付も表示している．</p>
</div>
<div class="section" id="id23">
<h3><span class="section-number">7.5.4. </span>課題4<a class="headerlink" href="#id23" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference external" href="https://open-meteo.com/en">Open-Meteo</a> というサイトは，無料で天気予報データをダウンロードできるサービスを提供している．決められた形式でサイトにHTTPSアクセスをすると，データがJSON形式でダウンロードされる仕組みである．このサイトの東京の天気予報データにアクセスする <a class="reference external" href="https://api.open-meteo.com/v1/forecast?latitude=35.6785&amp;longitude=139.6823&amp;hourly=temperature_2m,precipitation,windspeed_10m,winddirection_10m&amp;windspeed_unit=ms&amp;timezone=Asia%2FTokyo&amp;past_days=1">URL</a> を使おう．実行すると自動的にこのURLにアクセスし，ダウンロードしたデータ（プログラムを実行した時点での最新のデータ）を自動でプロットするプログラムを作成せよ．ただし，オプション無しで実行した場合には画面にプロットを表示し， <code class="docutils literal notranslate"><span class="pre">--save</span></code> オプションでファイル名を指定した場合には，指定されたファイル名（例えばpng形式など）でプロットをファイルに保存するようにせよ．例えば以下のようなプロットが得られればよい．この例のURLでは温度，降水量，風速と風向きをプロットしている．（Open-Meteoのサイトではダウンロードするデータを自分でカスタマイズすることができる．）</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/chap07_openmeteo.png"><img alt="_images/chap07_openmeteo.png" src="_images/chap07_openmeteo.png" style="width: 80%;" /></a>
</div>
<p>ここで， <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> を使うのであれば，時間が <code class="docutils literal notranslate"><span class="pre">numpy.datetime64</span></code> 形式の配列になっていれば，横軸は自動でこの例のようにフォーマットされる．なお，このようなスクリプトで実行する際にはプロットした後に <code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot.show()</span></code> を呼ぶと画面にウインドウが表示される．画面に表示せずにファイルに保存したい場合は <code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot.savefig()</span></code> を使えばよい．</p>
<hr class="docutils" />
<dl class="footnote brackets">
<dt class="label" id="crossplatform"><span class="brackets"><a class="fn-backref" href="#id13">1</a></span></dt>
<dd><p>もちろん色々な環境で動くように注意してプログラムを作れば，の話である．</p>
</dd>
<dt class="label" id="versionnote"><span class="brackets"><a class="fn-backref" href="#id17">2</a></span></dt>
<dd><blockquote>
<div><p>Pythonのバージョン3.7以上が必要．それ以前であれば</p>
</div></blockquote>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;echo&#39;</span><span class="p">,</span> <span class="s1">&#39;hello shell&#39;</span><span class="p">],</span> \
<span class="gp">... </span>        <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>などとする必要がある．</p>
</dd>
</dl>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="chap06.html" class="btn btn-neutral float-left" title="6. NumPy配列の基本" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, Takanobu Amano

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>